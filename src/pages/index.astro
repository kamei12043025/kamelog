---
import PageLayout from '../layouts/PageLayout.astro'
import type { BlogArticles } from '../types/BlogArticles.astro'
import { newtClient } from '../lib/newt'
import { Image } from 'astro:assets'
import FormattedDate from '@components/utils/FormattedDate.astro'

const { items: blogs } = await newtClient.getContents<BlogArticles>({
  appUid: 'blog',
  modelUid: 'article',
  query: {
    select: ['title', 'slug', 'body', 'tags', 'coverImage', '_sys'],
  },
})

const gridConfigs = [
  { cols: 'grid-cols-1 md:grid-cols-3 lg:grid-cols-3', slice: [0, 3] },
  { cols: 'grid-cols-1 md:grid-cols-3 lg:grid-cols-4', slice: [3, 11] },
]
---

<PageLayout
  title="KAMELOG"
  description="NewtとAstroを利用したブログです。日々のアウトプットを残していきます。"
>
<div class="grid grid-cols-12 gap-4">
  {
    gridConfigs.map(({ cols, slice }) => (
      <div class={`col-span-12 grid ${cols} gap-6`}>
        {blogs.slice(...slice).map((blog) => (
          <div class="col-span-1">
            <article
              aria-labelledby={blog.slug}
              data-href={`/blogs/${blog.slug}`}
              class="grid grid-rows-[auto_1fr] h-full bg-transparent transition-all group relative"
            >
              <div class="absolute bottom-0 left-0 w-full h-[1px] flex">
                <div class="w-1/3 theme-group-hover-border group-hover:w-full transition-all"></div>
                <div class="w-2/3 bg-gray-400 dark:bg-white"></div>
              </div>

              <a href={`/blogs/${blog.slug}`} aria-label="">
                <h2
                  id={blog.slug}
                  class="text-xl mb-2 row-start-2 line-clamp-2 theme-group-hover-text theme-color"
                >
                  {blog.title}
                </h2>
              </a>
              {blog.tags && blog.tags.length > 0 && (
                <div class="mb-2 row-start-3">
                  <span class="dark:text-white">Tag: </span>
                  {blog.tags.map((blogTag) => (
                    <a
                      href={`/tags/${blogTag.slug}`}
                      class="text-center px-2 py-1 ml-2 border border-gray-400 dark:border-white dark:text-white theme-color-hover text-xs "
                    >
                      #{blogTag.name}
                    </a>
                  ))}
                </div>
              )}
              <p class="mb-2 theme-color text-xs md:text-sm">
                <span>投稿日: </span>
                <FormattedDate date={blog._sys.raw.publishedAt} />
              </p>
              <a
                href={`/blogs/${blog.slug}`}
                class="row-start-1 mb-4 relative overflow-hidden"
              >
                {blog.coverImage && (
                  <Image
                    src={blog.coverImage.src}
                    width={blog.coverImage.width}
                    height={blog.coverImage.height}
                    fetchpriority="high"
                    loading="eager"
                    format="avif"
                    alt=""
                    class="w-full h-auto object-cover transition-transform group-hover:scale-110"
                  />
                )}
                <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                  <span class="text-white text-lg font-bold transform translate-y-1 group-hover:translate-y-0 transition-transform">
                    記事を読む
                  </span>
                </div>
              </a>
            </article>
          </div>
        ))}
      </div>
    ))
  }
</div>
</PageLayout>
